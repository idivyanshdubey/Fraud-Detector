<div class="dashboard-container">
  <!-- Header -->
  <header class="dashboard-header">
    <div class="header-content">
      <h1>🚨 Real-Time Fraud Detection Dashboard</h1>
      <div class="header-stats">
        <div class="connection-status" [class]="getConnectionStatusClass((connectionStatus$ | async) || '')">
          <span>{{ getConnectionStatusIcon((connectionStatus$ | async) || '') }}</span>
          <span>{{ (connectionStatus$ | async) || '' | titlecase }}</span>
        </div>
        <button class="refresh-btn" (click)="refreshData()" title="Refresh Data">
          🔄 Refresh
        </button>
        <button class="export-btn" (click)="exportAlerts()" title="Export Alerts">
          📥 Export
        </button>
        <button class="clear-btn" (click)="clearAlerts()" title="Clear All Alerts">
          🗑️ Clear Alerts
        </button>
      </div>
    </div>
  </header>

  <!-- Statistics Cards -->
  <section class="stats-section">
    <div class="stats-grid">
      <div class="stat-card total-alerts">
        <div class="stat-icon">📊</div>
        <div class="stat-content">
          <h3>Total Alerts</h3>
          <p class="stat-value">{{ (stats$ | async)?.total_alerts || 0 }}</p>
        </div>
      </div>
      
      <div class="stat-card alerts-hour">
        <div class="stat-icon">⏰</div>
        <div class="stat-content">
          <h3>Last Hour</h3>
          <p class="stat-value">{{ (stats$ | async)?.alerts_last_hour || 0 }}</p>
        </div>
      </div>
      
      <div class="stat-card alerts-day">
        <div class="stat-icon">📅</div>
        <div class="stat-content">
          <h3>Last 24h</h3>
          <p class="stat-value">{{ (stats$ | async)?.alerts_last_day || 0 }}</p>
        </div>
      </div>
      
      <div class="stat-card alert-rate">
        <div class="stat-icon">📈</div>
        <div class="stat-content">
          <h3>Avg Rate</h3>
          <p class="stat-value">{{ (stats$ | async)?.average_alert_rate_per_minute || 0 }}/min</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Dashboard Filters -->
  <section class="dashboard-filters-section">
    <h3 class="filters-section-title">🔍 Filter & Search Alerts</h3>
    <div class="dashboard-filters-container">
      <div class="search-filter-group">
        <label for="searchInput" class="filter-label">Search:</label>
        <input
          id="searchInput"
          type="text"
          placeholder="Search merchants, cards, transactions..."
          [(ngModel)]="searchTerm"
          (ngModelChange)="onSearchChange()"
          class="search-input-field"
        />
      </div>
      
      <div class="fraud-type-filter-group">
        <label for="fraudTypeSelect" class="filter-label">Fraud Type:</label>
        <select
          id="fraudTypeSelect"
          [(ngModel)]="selectedFraudType"
          (change)="onFraudTypeChange(selectedFraudType)"
          class="fraud-type-select-field"
        >
          <option *ngFor="let type of getFraudTypeOptions()" [value]="type">
            {{ type === 'ALL' ? 'All Types' : type }}
          </option>
        </select>
      </div>
      
      <div class="severity-filter-group">
        <label for="severitySelect" class="filter-label">Severity:</label>
        <select
          id="severitySelect"
          [(ngModel)]="selectedSeverity"
          (change)="onSeverityChange(selectedSeverity)"
          class="severity-select-field"
        >
          <option *ngFor="let severity of getSeverityOptions()" [value]="severity">
            {{ severity === 'ALL' ? 'All Severities' : severity }}
          </option>
        </select>
      </div>
      
      <div class="filter-actions-group">
        <button class="clear-filters-action-btn" (click)="clearFilters()">
          Clear Filters
        </button>
      </div>
    </div>
  </section>

  <!-- Fraud Types Distribution -->
  <section class="fraud-types-section" *ngIf="(stats$ | async)?.fraud_types">
    <h2>Fraud Types Distribution</h2>
    <div class="fraud-types-grid">
      <div 
        *ngFor="let fraudType of (stats$ | async)?.fraud_types | keyvalue"
        class="fraud-type-card"
      >
        <div class="fraud-type-icon">{{ getFraudTypeIcon(fraudType.key) }}</div>
        <div class="fraud-type-content">
          <h4>{{ fraudType.key }}</h4>
          <p>{{ fraudType.value }} alerts</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Alerts List -->
  <section class="alerts-section">
    <div class="section-header">
      <h2>Recent Fraud Alerts</h2>
      <span class="alert-count">{{ filteredAlerts.length }} alerts</span>
    </div>
    
    <div class="alerts-container">
      <div *ngIf="filteredAlerts.length === 0" class="no-alerts">
        <div class="no-alerts-icon">🔍</div>
        <p>No fraud alerts found</p>
        <p *ngIf="searchTerm || selectedFraudType !== 'ALL' || selectedSeverity !== 'ALL'">
          Try adjusting your filters
        </p>
      </div>
      
      <div class="alert-cards">
        <div 
          *ngFor="let alert of filteredAlerts; trackBy: trackByTransactionId"
          class="alert-card"
          [class]="getSeverityClass(alert.severity)"
        >
          <div class="alert-header">
            <div class="alert-type">
              <span class="fraud-icon">{{ getFraudTypeIcon(alert.fraud_type) }}</span>
              <span class="fraud-type">{{ alert.fraud_type }}</span>
            </div>
            <div class="alert-severity">
              <span class="severity-badge">{{ alert.severity }}</span>
            </div>
          </div>
          
          <div class="alert-body">
            <div class="alert-amount">
              <strong>{{ formatCurrency(alert.amount) }}</strong>
            </div>
            
            <div class="alert-details">
              <div class="detail-row">
                <span class="label">Merchant:</span>
                <span class="value">{{ alert.merchant }}</span>
              </div>
              
              <div class="detail-row">
                <span class="label">Card:</span>
                <span class="value">{{ alert.card_number | maskCard }}</span>
              </div>
              
              <div class="detail-row">
                <span class="label">Transaction ID:</span>
                <span class="value">{{ alert.transaction_id | slice:0:8 }}...</span>
              </div>
              
              <div class="detail-row">
                <span class="label">Reason:</span>
                <span class="value fraud-reason">{{ alert.fraud_reason }}</span>
              </div>
              
              <div class="detail-row">
                <span class="label">Time:</span>
                <span class="value">{{ getRelativeTime(alert.alert_timestamp) }}</span>
              </div>
              
              <div class="detail-row" *ngIf="alert.location">
                <span class="label">Location:</span>
                <span class="value">{{ alert.location.city }}, {{ alert.location.country }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>
